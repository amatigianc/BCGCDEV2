<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Stage_must_contain_Primary_Quote</fullName>
    <active>true</active>
    <errorConditionFormula>AND(
ISCHANGED(StageName),
ISBLANK(SBQQ__PrimaryQuote__c	),

RecordType.DeveloperName != &#39;Services_Record_Type&#39;, 
RecordType.DeveloperName != &#39;Customer_Experience_Request&#39;,
NOT(ISPICKVAL(Deal_Type__c, &#39;Renewal Growth&#39;) ),
 
OR( 
ISPICKVAL( StageName , &#39;2 - Demo&#39;),
ISPICKVAL( StageName , &#39;3 - Solution Design &amp; Evaluation&#39;),
ISPICKVAL( StageName , &#39;4 - Negotiation&#39;),
ISPICKVAL( StageName, &#39;Closed Won&#39;)
),  

NOT ( $Permission.Bypass_Validation_Rule)
)</errorConditionFormula>
    <errorDisplayField>SBQQ__PrimaryQuote__c</errorDisplayField>
    <errorMessage>Primary Quote cannot be blank when moving the stage (2,3 or 4 or closed won)</errorMessage>
</ValidationRule>
